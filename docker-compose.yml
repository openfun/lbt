version: "3.9"

services:

  locust:
    build: .
    ports:
     - "8089:8089"
    working_dir: /app
    # network_mode: host
    volumes:
      - ./src:/app/locust
      - ./data:/app/data
      - ./runs:/app/runs

  datasim:
    image: yetanalytics/datasim:latest
    environment:
      - CREDENTIALS=admin:funfunfun
      - API_ALLOWED_ORIGINS=*
    entrypoint: "bin/server.sh"
    ports:
      - 9090:9090
    volumes:
      - ./data:/bundle/data

  notebooks-notebook:
    build: ./notebooks
    user: ${DOCKER_USER:-1000}
    environment:
      NB_UID: ${DOCKER_UID:-1000}
      NB_GID: ${DOCKER_GID:-1000}
      CHOWN_HOME: 'yes'
      CHOWN_HOME_OPTS: -R
    ports:
      - 8888:8888
    volumes:
      - .:/home/jovyan/work
      - ./results:/mnt/results


  # -- Tools --
  dockerize:
    image: jwilder/dockerize
